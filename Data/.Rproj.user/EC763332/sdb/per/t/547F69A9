{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Cointegration in Crude Prices\"\nauthor: \"Cameron Pfiffer\"\ndate: \"July 17, 2017\"\noutput:\n  bookdown::pdf_document2: \n    latex_engine: xelatex\ncsl: harvard.csl\nbibliography: bibliography.bibtex\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = FALSE, include=FALSE, \n                      warning = FALSE, error = FALSE, message = FALSE,\n                      cache = TRUE)\n```\n\n```{r include=FALSE}\n# Libraries\nlibrary(tidyverse)\nlibrary(xts)\nlibrary(urca)\nlibrary(tseries)\n```\n\n```{r include=FALSE}\n# Functions\ncreate_xts <- function(df) {\n  df <- xts(df$price, df$date)\n  return(df)\n}\n```\n\n\\pagebreak\n\n# Introduction\nDetermining whether global oil markets are cointegrated is an important question, as doing so would allow a market participant to formulate trading strategies in cases where short-term relationships break down. It makes economic sense for the two oil grades to be cointegrated -- they are essentially substitutes, with similar specific gravities and sulfur content. Indeed, Adelman [-@10.2307/41321691] claimed that \"The world oil market, like the world ocean, is one great pool.\" This study reviews existing literature, examines the statistical relationship between Brent crude and West Texas Intermediate (WTI) crude, and proposes a trading strategy based on cointegration between the two securities.\n\n# Literature Review\n\n## Cointegration\nCointegration as a concept was first introduced by Granger [-@granger1981some], and later expanded upon to include methodology for testing cointegration [@engle1987co]. The theory states that non-stationary series integrated of the same order may have a cointegrating vector that reduces the resulting series to a stationary process, in which case the series are said to be _cointegrated_. Assets linked by a fundamental relationship have cause to be cointegrated, and the crude oil markets are no exception. WTI and Brent crudes are both highly similar commodities, with proximate specific gravities and sulfur contents. It makes sense that two nearly fungible assets would trade at similar levels, ignoring cost of carry and transit costs. Johansen [-@10.2307/2938278] later expanded upon the Engle-Granger methodology to expand to multivariate cointegrating relationships, and offered a solution to the issue of declaring one variable dependent on the other. This paper uses both methodologies to test for cointegration.\n\nThere are consistent findings amongst academics that WTI and Brent are cointegrated, and that oil levels are $I(1)$, but stationary in first differences, consistent with expectations. Hammoudeh et al. [-@showkat08] found cointegrating relationships in Brent and WTI (as well as Dubai and Maya crudes) using both the Engle-Granger method [-@engle1987co] and the M-TAR approach [@doi:10.1080/07350015.1998.10524769; @RePEc:bes:jnlbes:v:19:y:2001:i:2:p:166-76] which permits asymmetry in the return to equilibrium levels[^symmetry].  Fattouh [-@FATTOUH2010334] finds similar cointegrating relationships, though notes the presence of structural breaks and non-stationarity in crude price differentials in some extraordinary time periods. Numerous other academics have confirmed the existence of cointegration [@10.2307/41322733; @REBOREDO2011948; @kim2009study; @azar2017bias] using a variety of methodologies. \n\n[^symmetry]: Hammoudeh [-@showkat08] notes that there is cause to suspect asymmetrical returns to equilibrium; he cites the heterogeneity in global trader's expectations, compulsive and noisy trading, and transaction costs as potential factors. Asymmetry is highly important for trading strategies, though for simplicity, the cointegrating relationship between Brent and WTI is assumed to be symmetric.\n\n## Trading Strategy and Transaction Costs\nDeveloping a trading strategy to requires the awareness of several key facts. First, in a world absent transaction costs, any deviation from the mean should spur immediate mean reversion no matter how small, as noted by Balke and Famby [-@10.2307/2527284]. However, as we do not live in a world absent transaction costs and this is an empirical study (and thus subject to the whims of reality), an appropriate transaction cost must be assumed to evaluate the profitability of any trade. In this study, transaction costs are included by construction, as the trading simulation assumes that all purchases are make on the ask and all sales made on the bid. This is an overly simplified assumption, as this merely accounts for explicit transaction costs, and not implicit costs such as opportunity cost and market impact, among others[^tca].\n\n[^tca]: See Almgren and Chriss [-@almgren2001optimal] and Kissel [-@kissell2006expanded] for expanded transaction cost analysis methods.\n\nKawasaki et al. [-@kawasaki2003characterization] study contrarian and momentum trading strategies in cointegrated equities. Given that integrated series cross the mean frequently, the authors note that there are two general outcomes; first, that the spread between assets might continue away from the mean due to momentum; second, that an asset will revert towards the mean. They find Sharpe ratios of approximately 0.90 for the momentum strategy, and 0.59 for the contrarian strategy, though it should be noted that the contrarian strategy had far higher average returns, 10.69% versus the momentum strategy's 6.46%. \n\n\n# Statistical Tests\n\n## Data\n\nThe data used are daily close bid, ask, and midpoint prices for Dated Brent FOB and West Texas Intermediate FOB between January 1st, 1995 and July 14th, 2017, composing a total of 5,571 observations. Days when prices for either security was not available are removed, so that only days when both securities are traded are used. Furthermore, the data is segmented into two parts; a modeling set and a testing set. The cointegrating relationships are estimated using data between January 1st, 1995 and July 14th, 2015. The remaining two years of data is used to evaluate the trading strategy using the cointegrating vectors found in the preceding period.\n\n```{r include=FALSE}\n# Data import, cleaning, consolidation.\nbrent <- read_csv(\"../raw/BFO.csv\")\nbrent$date <- parse_date(brent$date, \"%d/%m/%Y\")\nbrent <- create_xts(brent)\n\nwti <- read_csv(\"../raw/WTI.csv\")\nwti$date <- parse_date(wti$date, \"%d/%m/%Y\")\nwti <- create_xts(wti)\n\nbrent_spread <- read_csv(\"../raw/BFObidask-daily.csv\")\nbrent_spread$date <- parse_date(brent_spread$date, \"%m/%d/%Y\")\nbrent_spread <- xts(brent_spread[,2:3], brent_spread$date)\nbrent_spread$spread <- brent_spread$ask - brent_spread$bid\n\nwti_spread <- read_csv(\"../raw/WTIbidask-daily.csv\")\nwti_spread$date <- parse_date(wti_spread$date, \"%m/%d/%Y\")\nwti_spread <- xts(wti_spread[,2:3], wti_spread$date)\nwti_spread$spread <- wti_spread$ask - wti_spread$bid\n\nspread <- na.omit(merge(wti_spread, brent_spread))\ncolnames(spread) <- c(\"w.ask\", \"w.bid\", \"w.spread\",\n                      \"b.ask\", \"b.bid\", \"b.spread\")\n\nprice <- merge(wti, brent)\n\n# Remove mismatched time series and remove NA\nprice <- na.omit(price[\"1995/\"])\n```\n\n\n\n## Lag Length Selection\n\nIt has been noted that lag length selection can have important effects on a VAR model's impulse response and variance decompositions [@66e755df06db415c83234a6bbc768a39], and Brooks [-@brooks2014introductory] notes that Johansen tests and Augmented Dickey-Fuller tests can be sucestible to improper lag selection. Thus, we select a lag length that creates produces the most parsimonious model, i.e., the smallest lag length. The `vars` package for R [@pfaff2013package] contains a built in function for multivariate information criterion. Table \\@ref(tab:ic) presents the lag lengths suggested by four information criteria tests. The Schwarz criterion suggests a lag length of 2.\n\n```{r}\nlibrary(vars)\nlag_length <- VARselect(price, type = 'const')\nll_table <- data.frame(lag_length$selection)\n```\n\n```{r ic,include=TRUE}\nknitr::kable(ll_table, col.names = \"Lag Length\", caption = \"Information Criteria Lag Length\", format = 'pandoc')\n```\n\n## Stationarity\n\nThe first step in determining whether two assets are cointegrated is to find whether they are both $I(0)$. The Augmented Dickey-Fuller test\n\n```{r}\nwti_adf <- adf.test(price$wti, k=2)\nbrent_adf <- adf.test(price$brent, k=2)\n\nfor(i in 1:30) {\n  pvals[i] = adf.test(price$wti, k=i)$p.value\n}\n```\n\n\n# Testing for cointegration\n\nThis test evaluates whether or not an intercept would help model the data better.\n\n```{r echo=TRUE,include=TRUE}\njoc <- ca.jo(price, type = 'eigen', ecdet = 'const',\n                  K = 2, spec = 'transitory')\nsummary(joc)\n```\n\n```{r}\n# Graph the spread\nrange = '2005/'\nautoplot(price$brent[range] - price$wti[range]) +\n  ylab(\"Spread\") +\n  ggtitle(\"Brent/WTI Spread\")\n```\n\n\n\n```{r include=TRUE}\n# Add constant to dataset\npricecon <- price\npricecon$constant <- rep(1)\n\nsc1 <- xts(pricecon %*% joc@V[,1], order.by = index(price))\nsc2 <- xts(pricecon %*% joc@V[,2], order.by = index(price))\nsc3 <- xts(pricecon %*% joc@V[,3], order.by = index(price))\n\nggplot() +\n  geom_line(mapping = aes(Index, sc1), color = 'blue', data = fortify(sc1)) +\n  geom_line(mapping = aes(Index, sc2), color = 'red', data = fortify(sc2)) + \n  geom_line(mapping = aes(Index, sc3), color = 'purple', data = fortify(sc3))\n```\n\n\n```{r include=TRUE}\nggplot() +\n  geom_line(mapping = aes(Index, sc1), color = 'blue', data = fortify(sc1)) +\n  geom_line(mapping = aes(Index, (price$brent - price$wti)), color = 'red', data = fortify(sc2))\n```\n\n# Turning the VECM into a VAR\n\n```{r}\nvarc <- vars::vec2var(joc)\n```\n\n\n\nThe structural break that occurs in recent periods is making the mean-reversion model fall apart, let's look at a model based on a smaller subsample.\n\n```{r}\nsubjo <- ca.jo(price['2010/2015'], type = 'eigen', ecdet = 'const',\n                  K = 2, spec = 'transitory')\n\nsubstationary <- xts(pricecon['2010/'] %*% subjo@V[,1], \n                     order.by = index(pricecon['2010/']))\nggplot() +\n  geom_line(mapping = aes(Index, substationary), color = 'blue', \n            data = fortify(substationary)) +\n  geom_line(mapping = aes(Index, (price$brent['2010/'] - price$wti['2010/'])),\n            color = 'red', data = fortify(substationary))\n```\n\n```{r}\nvarcs <- vars::vec2var(subjo)\n```\n\n\n\n\n# References\n",
    "created" : 1500286875614.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "61|20|89|0|\n",
    "hash" : "2443043393",
    "id" : "547F69A9",
    "lastKnownWriteTime" : 1501075752,
    "last_content_update" : -2147483648,
    "path" : "C:/Users/cpfif/Documents/R/Energy Finance/Data/Documents/main.rmd",
    "project_path" : "Documents/main.rmd",
    "properties" : {
        "chunk_output_type" : "inline",
        "last_setup_crc32" : "4860F6B371a8b715",
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}