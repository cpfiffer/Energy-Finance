bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent
bidask_brent <- create_xts(bidask_brent)
bidask_brent
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- xts(bidask_brent)
bidask_brent <- xts(bidask_brent, order.by = date)
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- xts(bidask_brent, order.by = date)
bidask_brent <- xts(bidask_brent, order.by = bidask_brent$date)
head(bidask_brent)
bidask_brent
str(bidask_brent)
# Functions
create_xts <- function(df) {
df <- xts(df$price, df$date)
return(df)
}
create_xts2 <- function(df) {
# Use for bid/ask datasets
df <- xts(df$bid, df$ask, order.by=df$date)
return(df)
}
bidask_brent <- create_xts2(bidask_brent)
?xts
# Functions
create_xts <- function(df) {
df <- xts(df$price, df$date)
return(df)
}
create_xts2 <- function(df) {
# Use for bid/ask datasets
df <- xts(c(df$bid, df$ask), order.by=df$date)
return(df)
}
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
biask$brent
bidask_brent
xts(bidask_brent[,2:3])
xts(bidask_brent[,2:3], bidask_brent[,1])
xts(bidask_brent[,2:3],order.by =  bidask_brent[,1])
xts(bidask_brent[,2:3],order.by =  bidask_brent$date)
# Functions
create_xts <- function(df) {
df <- xts(df$price, df$date)
return(df)
}
create_xts2 <- function(df) {
# Use for bid/ask datasets
df <- xts(df[,2:3], order.by=df$date)
return(df)
}
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
bidask_wti <- create_xts(bidask_wti)
bidask_wti
bidask_brent
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
head(bidask_wti)
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
head(bidask_wti)
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
bidask_wti <- create_xts2(bidask_wti)
```{r messages=FALSE}
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
bidask_wti <- create_xts2(bidask_wti)
# Data import, cleaning, consolidation.
brent <- read_csv("../raw/BFO.csv")
brent$date <- parse_date(brent$date, "%d/%m/%Y")
brent <- create_xts(brent)
wti <- read_csv("../raw/WTI.csv")
wti$date <- parse_date(wti$date, "%d/%m/%Y")
wti <- create_xts(wti)
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
bidask_wti <- create_xts2(bidask_wti)
spread <- na.omit(merge(wti_spread, brent_spread))
colnames(spread) <- c("w.ask", "w.bid", "w.spread",
"b.ask", "b.bid", "b.spread")
price <- na.omit(merge(wti, brent))
# Format total dataframe in OLS format
p_tib <- as_tibble(price)
p_tib <- mutate(p_tib,
wti.dl1 = diff.xts(wti),
brent.dl1 = diff.xts(brent),
wti.l1  = lag.xts(wti),
brent.l1 = lag.xts(brent),
constant = 1)
p_tib <- xts(p_tib, order.by = index(price))["1995/"]
test_set <- price["2015-07-15/"]
# Remove mismatched time series and remove NA
price <- price["1995/2015-07-14"]
head(spread)
bidask_spread <- na.omit(merge(wti_spread, brent_spread))
bidask_spread
autoplot(bidask_spread$wti.s)
head(bidask_spread)
# Data import, cleaning, consolidation.
brent <- read_csv("../raw/BFO.csv")
brent$date <- parse_date(brent$date, "%d/%m/%Y")
brent <- create_xts(brent)
wti <- read_csv("../raw/WTI.csv")
wti$date <- parse_date(wti$date, "%d/%m/%Y")
wti <- create_xts(wti)
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
bidask_wti <- create_xts2(bidask_wti)
bidask_spread <- na.omit(merge(wti_spread, brent_spread))
colnames(spread) <- c("w.ask", "w.bid", "w.spread",
"b.ask", "b.bid", "b.spread")
price <- na.omit(merge(wti, brent))
# Format total dataframe in OLS format
p_tib <- as_tibble(price)
p_tib <- mutate(p_tib,
wti.dl1 = diff.xts(wti),
brent.dl1 = diff.xts(brent),
wti.l1  = lag.xts(wti),
brent.l1 = lag.xts(brent),
constant = 1)
p_tib <- xts(p_tib, order.by = index(price))["1995/"]
test_set <- price["2015-07-15/"]
# Remove mismatched time series and remove NA
price <- price["1995/2015-07-14"]
head(bidask_spread)
# Data import, cleaning, consolidation.
brent <- read_csv("../raw/BFO.csv")
brent$date <- parse_date(brent$date, "%d/%m/%Y")
brent <- create_xts(brent)
wti <- read_csv("../raw/WTI.csv")
wti$date <- parse_date(wti$date, "%d/%m/%Y")
wti <- create_xts(wti)
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
bidask_wti <- create_xts2(bidask_wti)
bidask_spread <- na.omit(merge(wti_spread, brent_spread))
colnames(bidask_spread) <- c("w.ask", "w.bid", "w.spread",
"b.ask", "b.bid", "b.spread")
price <- na.omit(merge(wti, brent))
# Format total dataframe in OLS format
p_tib <- as_tibble(price)
p_tib <- mutate(p_tib,
wti.dl1 = diff.xts(wti),
brent.dl1 = diff.xts(brent),
wti.l1  = lag.xts(wti),
brent.l1 = lag.xts(brent),
constant = 1)
p_tib <- xts(p_tib, order.by = index(price))["1995/"]
test_set <- price["2015-07-15/"]
# Remove mismatched time series and remove NA
price <- price["1995/2015-07-14"]
head(bidask_spread)
tail(bidask_spread)
p_tib <- mutate(p_tib,
wti.dl1 = diff.xts(wti),
brent.dl1 = diff.xts(brent),
wti.l1  = lag.xts(wti),
brent.l1 = lag.xts(brent),
constant = 1,
wtibidask = bidask_spread$w.spread,
brentbidask=bidask_spread$b.spread)
knitr::opts_chunk$set(echo = FALSE, include=FALSE,
warning = FALSE, error = FALSE, message = FALSE)
# Libraries
library(tidyverse)
library(xts)
library(urca)
library(tseries)
library(tidyquant)
# Functions
create_xts <- function(df) {
df <- xts(df$price, df$date)
return(df)
}
create_xts2 <- function(df) {
# Use for bid/ask datasets
df <- xts(df[,2:3], order.by=df$date)
return(df)
}
# Data import, cleaning, consolidation.
brent <- read_csv("../raw/BFO.csv")
brent$date <- parse_date(brent$date, "%d/%m/%Y")
brent <- create_xts(brent)
wti <- read_csv("../raw/WTI.csv")
wti$date <- parse_date(wti$date, "%d/%m/%Y")
wti <- create_xts(wti)
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
bidask_wti <- create_xts2(bidask_wti)
bidask_spread <- na.omit(merge(wti_spread, brent_spread))
# Data import, cleaning, consolidation.
brent <- read_csv("../raw/BFO.csv")
brent$date <- parse_date(brent$date, "%d/%m/%Y")
brent <- create_xts(brent)
wti <- read_csv("../raw/WTI.csv")
wti$date <- parse_date(wti$date, "%d/%m/%Y")
wti <- create_xts(wti)
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
bidask_wti <- create_xts2(bidask_wti)
bidask_spread <- na.omit(merge(bidask_wti, bidask_brent))
colnames(bidask_spread) <- c("w.ask", "w.bid", "w.spread",
"b.ask", "b.bid", "b.spread")
bidask_spread
head(bidask_spread)
knitr::opts_chunk$set(echo = FALSE, include=FALSE,
warning = FALSE, error = FALSE, message = FALSE)
# Libraries
library(tidyverse)
library(xts)
library(urca)
library(tseries)
library(tidyquant)
# Functions
create_xts <- function(df) {
df <- xts(df$price, df$date)
return(df)
}
create_xts2 <- function(df) {
# Use for bid/ask datasets
df <- xts(df[,2:3], order.by=df$date)
return(df)
}
# Data import, cleaning, consolidation.
brent <- read_csv("../raw/BFO.csv")
brent$date <- parse_date(brent$date, "%d/%m/%Y")
brent <- create_xts(brent)
wti <- read_csv("../raw/WTI.csv")
wti$date <- parse_date(wti$date, "%d/%m/%Y")
wti <- create_xts(wti)
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
bidask_brent$spread <- bidask_brent$ask - bidask_brent$bid
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
bidask_wti <- create_xts2(bidask_wti)
bidask_wti <- bidask_wti$ask-bidask_wti$bid
bidask_spread <- na.omit(merge(bidask_wti, bidask_brent))
colnames(bidask_spread) <- c("w.ask", "w.bid", "w.spread",
"b.ask", "b.bid", "b.spread")
head(bidask_spread)
# Data import, cleaning, consolidation.
brent <- read_csv("../raw/BFO.csv")
brent$date <- parse_date(brent$date, "%d/%m/%Y")
brent <- create_xts(brent)
wti <- read_csv("../raw/WTI.csv")
wti$date <- parse_date(wti$date, "%d/%m/%Y")
wti <- create_xts(wti)
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
bidask_brent$spread <- bidask_brent$ask - bidask_brent$bid
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
bidask_wti <- create_xts2(bidask_wti)
bidask_wti$spread <- bidask_wti$ask-bidask_wti$bid
bidask_spread <- na.omit(merge(bidask_wti, bidask_brent))
colnames(bidask_spread) <- c("w.ask", "w.bid", "w.spread",
"b.ask", "b.bid", "b.spread")
price <- na.omit(merge(wti, brent))
# Format total dataframe in OLS format
p_tib <- as_tibble(price)
p_tib <- mutate(p_tib,
wti.dl1 = diff.xts(wti),
brent.dl1 = diff.xts(brent),
wti.l1  = lag.xts(wti),
brent.l1 = lag.xts(brent),
constant = 1,
wtibidask = bidask_spread$w.spread,
brentbidask=bidask_spread$b.spread)
# Data import, cleaning, consolidation.
brent <- read_csv("../raw/BFO.csv")
brent$date <- parse_date(brent$date, "%d/%m/%Y")
brent <- create_xts(brent)
wti <- read_csv("../raw/WTI.csv")
wti$date <- parse_date(wti$date, "%d/%m/%Y")
wti <- create_xts(wti)
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
bidask_brent$spread <- bidask_brent$ask - bidask_brent$bid
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
bidask_wti <- create_xts2(bidask_wti)
bidask_wti$spread <- bidask_wti$ask-bidask_wti$bid
bidask_spread <- merge(bidask_wti, bidask_brent)
colnames(bidask_spread) <- c("w.ask", "w.bid", "w.spread",
"b.ask", "b.bid", "b.spread")
price <- na.omit(merge(wti, brent))
# Format total dataframe in OLS format
p_tib <- as_tibble(price)
p_tib <- mutate(p_tib,
wti.dl1 = diff.xts(wti),
brent.dl1 = diff.xts(brent),
wti.l1  = lag.xts(wti),
brent.l1 = lag.xts(brent),
constant = 1,
wtibidask = bidask_spread$w.spread,
brentbidask=bidask_spread$b.spread)
knitr::opts_chunk$set(echo = FALSE, include=FALSE,
warning = FALSE, error = FALSE, message = FALSE)
# Libraries
library(tidyverse)
library(xts)
library(urca)
library(tseries)
library(tidyquant)
# Functions
create_xts <- function(df) {
df <- xts(df$price, df$date)
return(df)
}
create_xts2 <- function(df) {
# Use for bid/ask datasets
df <- xts(df[,2:3], order.by=df$date)
return(df)
}
# Data import, cleaning, consolidation.
brent <- read_csv("../raw/BFO.csv")
brent$date <- parse_date(brent$date, "%d/%m/%Y")
brent <- create_xts(brent)
wti <- read_csv("../raw/WTI.csv")
wti$date <- parse_date(wti$date, "%d/%m/%Y")
wti <- create_xts(wti)
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
bidask_brent$spread <- bidask_brent$ask - bidask_brent$bid
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
bidask_wti <- create_xts2(bidask_wti)
bidask_wti$spread <- bidask_wti$ask-bidask_wti$bid
bidask_spread <- merge(bidask_wti, bidask_brent)
colnames(bidask_spread) <- c("w.ask", "w.bid", "w.spread",
"b.ask", "b.bid", "b.spread")
price <- na.omit(merge(wti, brent, bidask_spread))
# Format total dataframe in OLS format
p_tib <- as_tibble(price)
p_tib <- mutate(p_tib,
wti.dl1 = diff.xts(wti),
brent.dl1 = diff.xts(brent),
wti.l1  = lag.xts(wti),
brent.l1 = lag.xts(brent),
constant = 1,
wtibidask = bidask_spread$w.spread,
brentbidask=bidask_spread$b.spread)
head(p_tib)
knitr::opts_chunk$set(echo = FALSE, include=FALSE,
warning = FALSE, error = FALSE, message = FALSE)
# Libraries
library(tidyverse)
library(xts)
library(urca)
library(tseries)
library(tidyquant)
# Functions
create_xts <- function(df) {
df <- xts(df$price, df$date)
return(df)
}
create_xts2 <- function(df) {
# Use for bid/ask datasets
df <- xts(df[,2:3], order.by=df$date)
return(df)
}
# Data import, cleaning, consolidation.
brent <- read_csv("../raw/BFO.csv")
brent$date <- parse_date(brent$date, "%d/%m/%Y")
brent <- create_xts(brent)
wti <- read_csv("../raw/WTI.csv")
wti$date <- parse_date(wti$date, "%d/%m/%Y")
wti <- create_xts(wti)
# Now we import bid/ask spreads and some other stuff.
bidask_brent <- read_csv("../raw/BFObidask-daily.csv")
bidask_brent$date <- parse_date(bidask_brent$date, "%m/%d/%Y")
bidask_brent <- create_xts2(bidask_brent)
bidask_brent$spread <- bidask_brent$ask - bidask_brent$bid
bidask_wti <- read_csv("../raw/WTIbidask-daily.csv")
bidask_wti$date <- parse_date(bidask_wti$date, "%m/%d/%Y")
bidask_wti <- create_xts2(bidask_wti)
bidask_wti$spread <- bidask_wti$ask-bidask_wti$bid
bidask_spread <- merge(bidask_wti, bidask_brent)
colnames(bidask_spread) <- c("w.ask", "w.bid", "w.spread",
"b.ask", "b.bid", "b.spread")
price <- na.omit(merge(wti, brent, bidask_spread))
# Format total dataframe in OLS format
p_tib <- as_tibble(price)
p_tib <- mutate(p_tib,
wti.dl1 = diff.xts(wti),
brent.dl1 = diff.xts(brent),
wti.l1  = lag.xts(wti),
brent.l1 = lag.xts(brent),
constant = 1)
p_tib <- xts(p_tib, order.by = index(price))["1995/"]
test_set <- price["2015-07-15/"]
# Remove mismatched time series and remove NA
price <- price["1995/2015-07-14"]
library(vars)
lag_length <- VARselect(price, type = 'const')
ll_table <- data.frame(lag_length$selection)
knitr::kable(ll_table, col.names = "Lag Length", caption = "Information Criteria Lag Length", format = 'pandoc')
wti_adf <- adf.test(price$wti, k=2)
brent_adf <- adf.test(price$brent, k=2)
summarise_adf <- function(adf) {
adf_sum <- c(adf$statistic, adf$p.value)
names(adf_sum) <- c("Augmented Dickey-Fulley Statistic", "P Value")
return(adf_sum)
}
wti_adf_summary <- summarise_adf(wti_adf)
brent_adf_summary <- summarise_adf(brent_adf)
adf_table <- t(data.frame(wti_adf_summary, brent_adf_summary))
row.names(adf_table) <- c("WTI", "Brent")
knitr::kable(adf_table, caption = "Augmented Dickey-Fuller Summary",
format = 'pandoc')
eg <- lm(formula = (wti) ~ (brent), data = price)
eg_adf <- adf.test(eg$residuals, k=2)
eg_dat <- data.frame(diff(price$wti), diff(price$brent), lag(eg$residuals))
eg_correction <- lm(wti ~ brent + lag.eg.residuals.,
na.action = na.omit,data = eg_dat)
epsilon <- data.frame(eg_adf$statistic, eg_adf$p.value)
colnames(epsilon) <- c("Augmented Dickey-Fulley Statistic", "P Value")
row.names(epsilon) <- "$\\epsilon$"
eg_summary <- summary(eg_correction)
eg_coef <- eg_summary$coefficients
row.names(eg_coef) <- c("Intercept ($\\alpha$)",
"Brent ($\\beta_1$)",
"Residuals ($\\epsilon$)")
knitr::kable(epsilon, caption = "Engle-Granger Residuals Test",
format = 'pandoc')
knitr::kable(eg_coef, caption = "Engle-Granger Error Correction Model Summary",
format = 'pandoc')
# Test OLS stuff
ass1 <- "$\\text{E}(\\epsilon_t)=0$"
ass2 <- "$\\text{var}(u_t)=\\sigma^2 < \\infinity$"
white <- white.test(as.ts(eg$residuals))
ass3 <- "$\\text{cov}(u_t, u_j)=0$"
ass4 <- "$\\text{cov}(u_t,x_t) = 0$"
ass5 <- "$u_t ~ N(0, \\sigma^2)$"
row1 <- c(ass1, paste("Residual mean is ", mean(eg$residuals)))
row2 <- c(ass1, paste("White test pvalue is ", white$p.value))
fitted = xts(eg_correction$fitted.values,
order.by = as.Date(names(eg_correction$fitted.values)))
colnames(fitted) <- "Fitted"
joc <- ca.jo(price, type = 'eigen', ecdet = 'const',
K = 2, spec = 'transitory')
joc <- ca.jo(price[,1:2], type = 'eigen', ecdet = 'const',
K = 2, spec = 'transitory')
summary(joc)
# Turn Johansen into an OLS equation, plot results
jocols <- cajools(joc)
jocols
# Graph the spread
range = '2005/'
autoplot(price$brent[range] - price$wti[range]) +
ylab("Spread") +
ggtitle("Brent/WTI Spread")
joc <- ca.jo(price[,1:2], type = 'eigen', ecdet = 'const',
K = 2, spec = 'transitory')
summary(joc)
# Cointegrated via Engle-Granger
spread <- (p_tib$wti.l1 - eg_coef[2]*p_tib$brent.l1)/eg_coef[3]
res <- na.omit(lag(eg$residuals))
res2 <- eg$coefficients[1] + eg$coefficients[2]*p_tib$brent
res3 <-
autoplot(spread)
ggplot() +
geom_histogram(mapping = aes(res), bins = 500)
joc@v[3,1]
joc@V
